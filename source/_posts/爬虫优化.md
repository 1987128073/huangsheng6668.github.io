---
title: 爬虫优化
date: 2020-07-01 18:40:30
tags: 爬虫
categories: 爬虫
---

### 爬虫优化

#### 当用户在浏览器输入URL回车时，到浏览器显示网页数据发生了什么？

![YG5svn.png](https://s1.ax1x.com/2020/05/11/YG5svn.png)

1. 发起http请求，通过DNS解析把域名转换成IP

2. DNS解析又分为：

   - 本地解析
     - DNS服务器

   把域名解析为IP，解析耗时在10-100毫秒不等

3. 然后有些网站会走CDN分发，CDN上缓存了服务器上的网页数据，当客户端发请求之后，CDN分发会选择物理位置最近的CDN，用于减轻服务器压力

4. 当流量太大了，网站需要做负载均衡，负载均衡就是一种分布式技术，通过分发流量，减轻WEB服务器压力

##### DNS优化

查询DNS解析耗时：通过在控制台`dig 域名`的方式来查询DNS解析的耗时

**重点：结合DNS解析直接请求IP的方法，如果网站有10个CDN节点，一个IP可以比以前多请求19倍才报废（节省开支）**

如何优化：

1. 直接请求IP，绕过DNS域名解析环节（通过`ping 域名`的方式直接查到IP）
2. 搜索引擎爬虫会维护DNS池

##### CDN分发如何优化

**在请求IP地址**

##### 如何确定对方有用CDN

	1. 用两个不同省份的IP去ping域名 

   	2. 观察域名或reponse的header

CDN注意事项：

​	CDN一般针对图片和视频，也有部分网站全使用CDN，CDN会缓存静态资源，如果动态的数据也放在CDN，CDN会频繁缓存，这是不好的。



##### 关注SEO的网站，网站会有sitemap

尤其是新闻类、漫画类、小说类网站（sitemap.xml一般放在robots.txt,也可以通过/sitemap.xml这样的方式去试）

抓sitemap的好处：

	1. 可以提供大量的种子url，甚至全站的URL都有

   	2. 方便抓取网站新增URL



##### URL规律抓取

1. URL里的id号自增
2. URL有关联关系
3. URL能遍历完

#### 出现验证码

 降低爬虫难度，爬虫尽可能不要触发验证码，少去对抗对方的反爬系统、风控系统，尽可能模拟正常访问行为

##### 容易出现验证码的情况

1. header信息始终不变
2. 账号异地登录（IP的地区控制不住）
3. 脏IP
4. 抓取对方的搜索接口

##### 验证码解决办法

1. 对抗破解
2. 打码平台
3. IP切换（推荐）
     - adsl拨号
     - 代理IP
4. 寻找绕过方法