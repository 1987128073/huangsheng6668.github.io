---
title: kafka入门
date: 2020-07-01 18:43:17
tags: 中间件
categories: 中间件
---

#### kafka入门

#### 什么是消息队列

利用高效可靠的消息传递机制进行**异步**的数据传输，并基于数据通信进行**分布式系统的集成**。通过提供**消息队列模型**和**消息传递机制**，可以在分布式环境下扩展进程间的通信。



#### 为什么要用消息队列

1. 解耦

   多个系统对接一个系统，那个系统则需要进行多个系统接口的相应处理，增加系统的耦合，但如果接口通过消息队列进行对接，则系统将被解耦。如图

   ![Y6ea0s.png](https://s1.ax1x.com/2020/05/16/Y6ea0s.png)

   

2. 削峰/限流

   ![Y6nwWV.png](https://s1.ax1x.com/2020/05/16/Y6nwWV.png)如图上所示，当一个服务器每秒要承受那么多请求，假设系统A只能处理每秒10000次请求，则多出来1000的请求则可能会导致**系统崩溃**。所以我们引入消息队列：

   ![Y6n5QO.png](https://s1.ax1x.com/2020/05/16/Y6n5QO.png)

系统B和系统C**根据自己的能够处理的请求数去消息队列中拿数据**，这样即便有每秒有11000个请求，请求也只是发到消息队列，由**系统自己去取数据**，这样就不会把整个系统给搞崩。

#### 消息队列需要考虑的问题

1. 高可用

   消息队列不能单机，否在一个消息队列挂掉了意味着整个系统被挂掉了。所以，消息队列必须都是**集群/分布式**的。要做集群/分布式就希望该消息队列能够提供现成的支持，不需要自己手动写代码实现。

2. 数据丢失

   生产者将消息发送到消息队列上时，消费者没来得及消费，消息队列就挂掉了，**如果没有做任何措施，数据将会丢失。**

3. 消费者怎么取消息队列数据

   有两种方法：

   	- 生产者将数据放到消息队列（push），消息队列有数据，主动叫消费者去拿
   	- 消费者通过轮询消息队列，如果有消息，那就消费(pull)

4. 其他

   诸如消息重复消费、保证消息有序；所以引入消息队列也会提高系统的复杂性。

#### kafka概念

kafka是一个领英开发的消息队列，其由topic(其实也就是队列)、broker(Kafka的服务器，一个Kafka服务器对应一个broker)、Partition(分区)、Consumer（消费者）、Product（生产者）组成。

[![YRGxns.png](https://s1.ax1x.com/2020/05/17/YRGxns.png)](https://imgchr.com/i/YRGxns)



#### 其他消息系统的优、劣势

表现形式：

- 消息队列

  一组消费者从消息队列中获取消息，消息会被推送给组中的某一个消费者

  优势：水平扩展，可以将消息数据分开处理

  劣势：消息队列不是多用户的，当一条消息记录被一个进程读取后，消息便会丢失

- 发布/订阅

  消息会广播发送给所有消费者

  优势：可以多进程共享消息

  劣势：每个消费者都会获得所有消息，无法通过添加消费进程提高处理效率